#!/usr/bin/env ruby

require "clip"

options = {}
clip = Clip do |c|
  c.banner = 'USAGE: centurion /some/ruby/app'
  c.optional 'r', 'commit_range', :desc => 'A git commit or range of commits to process',
                                  :default => 'HEAD',
                                  :multi => true
  c.flag     'v', 'verbose',      :desc => 'Make it chatty'
end

if directory = clip.remainder.shift
  options[:project_root] = File.expand_path directory
end
options[:verbose] = clip.verbose?
options[:commit_range] = clip.commit_range.map {|range| range.split('..') }.flatten
if 1 == options[:commit_range].size
   options[:commit_range].unshift "#{options[:commit_range].first}^"
end

unless clip.valid? && options[:project_root] && clip.remainder.empty?
  $stderr.puts clip.to_s
  exit 1
end


if $0 == './bin/centurion'
  require 'lib/centurion'
else
  require 'centurion'
end

Centurion::Collector.new(options).meter
